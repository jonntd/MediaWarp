<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaWarp - ä»»åŠ¡è°ƒåº¦å™¨</title>

    <!-- é˜²æ­¢æœç´¢å¼•æ“ç´¢å¼• -->
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="googlebot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="bingbot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="slurp" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="duckduckbot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="baiduspider" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="yandexbot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">

    <!-- é˜²æ­¢ç¤¾äº¤åª’ä½“çˆ¬è™« -->
    <meta property="og:title" content="Private Application">
    <meta property="og:description" content="This is a private application">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Private Application">
    <meta name="twitter:description" content="This is a private application">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --accent-color: #4895ef;
            --text-color: #333;
            --text-light: #666;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --border-color: #e0e0e0;
            --success-color: #4caf50;
            --error-color: #f44336;
            --warning-color: #ff9800;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        /* æš—é»‘æ¨¡å¼å˜é‡ */
        .dark-mode {
            --primary-color: #4cc9f0;
            --secondary-color: #4895ef;
            --accent-color: #3f37c9;
            --text-color: #e0e0e0;
            --text-light: #b0b0b0;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --border-color: #333;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            font-size: 14px;
            line-height: 1.5;
            transition: var(--transition);
        }

        .container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            padding: 12px;
            flex: 1;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 0;
            box-shadow: var(--shadow);
            position: relative;
            z-index: 10;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .theme-toggle {
            background: transparent;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        label {
            font-weight: 500;
            color: var(--text-color);
            font-size: 14px;
        }

        select {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 14px;
            transition: var(--transition);
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px;
        }

        .dark-mode select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23e0e0e0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        }

        input {
            padding: 12px 15px;
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color);
            transition: var(--transition);
            font-family: inherit;
        }

        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.3);
        }

        input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.3);
        }

        button {
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.3);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #45a049;
        }

        .btn-danger {
            background-color: var(--error-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #d32f2f;
        }

        .action-btn {
            background-color: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: var(--transition);
            font-weight: 500;
            font-size: 13px;
        }

        .action-btn:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .action-btn.danger:hover {
            background-color: var(--error-color);
            border-color: var(--error-color);
        }

        .task-section {
            background-color: var(--card-bg);
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .section-title {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            font-size: 18px;
        }

        .task-section form,
        .task-section .task-manager-status,
        .task-section .task-list {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        .user-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--card-bg);
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-light);
        }

        .user-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .task-list {
            margin-top: 20px;
        }

        .task-list table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .task-list th, .task-list td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .task-list th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .task-list td {
            color: var(--text-color);
            font-size: 14px;
        }

        .task-list tr:hover {
            background-color: rgba(67, 97, 238, 0.05);
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        .task-actions button {
            margin: 0;
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
        }

        .task-actions .delete-btn {
            background-color: var(--error-color);
        }

        .task-actions .delete-btn:hover {
            background-color: #d32f2f;
        }

        .cron-help {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            box-shadow: var(--shadow);
        }

        .cron-examples {
            margin-top: 10px;
        }

        .cron-examples code {
            background-color: #f8f9fa;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }

        .task-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-active {
            background-color: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background-color: #f8d7da;
            color: #721c24;
        }

        .function-description {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }

        .message {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .error-message {
            background-color: #ffebee;
            color: #c62828;
            border-left: 4px solid var(--error-color);
        }

        .success-message {
            background-color: #e8f5e8;
            color: #2e7d32;
            border-left: 4px solid var(--success-color);
        }

        .warning-message {
            background-color: #fff3e0;
            color: #ef6c00;
            border-left: 4px solid var(--warning-color);
        }

        .message i {
            font-size: 1.1rem;
        }

        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #6c757d;
        }

        .logout-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .logout-btn:hover {
            background-color: #5a6268;
        }

        .api-status {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #28a745;
            margin-right: 5px;
        }

        /* TaskManagerçŠ¶æ€æ ·å¼ */
        .task-manager-status {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .status-loading {
            text-align: center;
            color: var(--text-light);
            padding: 20px;
        }

        .status-idle {
            text-align: center;
            color: var(--text-light);
            padding: 20px;
        }

        .status-idle i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--success-color);
        }

        .status-running {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        .current-task {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .current-task h4 {
            margin: 0 0 10px 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .current-task .task-name {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .current-task .task-info {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .task-queue {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
        }

        .task-queue h4 {
            margin: 0 0 15px 0;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .queue-empty {
            color: var(--text-light);
            font-style: italic;
            text-align: center;
            padding: 10px;
        }

        .queue-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .queue-item {
            padding: 8px 12px;
            margin-bottom: 5px;
            background: var(--bg-color);
            border-radius: 4px;
            border-left: 3px solid var(--accent-color);
            font-size: 0.9rem;
        }

        .queue-item:last-child {
            margin-bottom: 0;
        }

        .queue-item .item-number {
            color: var(--text-light);
            font-weight: bold;
            margin-right: 8px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 8px;
            }

            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .header-actions {
                justify-content: center;
            }

            .user-bar {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .user-actions {
                justify-content: center;
            }

            .status-running {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .section-title {
                padding: 12px 15px;
                font-size: 14px;
            }

            .task-section form,
            .task-section .task-manager-status,
            .task-section .task-list {
                padding: 15px;
            }

            .form-group {
                margin-bottom: 15px;
            }

            .btn {
                width: 100%;
                margin-bottom: 10px;
            }

            .action-btn {
                font-size: 12px;
                padding: 6px 10px;
            }
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(2px);
        }

        .modal-content {
            background-color: var(--card-bg);
            margin: 5% auto;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }

        .close {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            opacity: 0.8;
            transition: var(--transition);
        }

        .close:hover {
            opacity: 1;
        }

        .modal-body {
            padding: 25px;
        }

        .custom-sync-config {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .custom-sync-config h4 {
            margin: 0 0 15px 0;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        @media (max-width: 768px) {
            .modal-content {
                margin: 10% auto;
                width: 95%;
            }

            .modal-header {
                padding: 15px;
            }

            .modal-body {
                padding: 20px;
            }

            .form-actions {
                flex-direction: column;
            }

            .task-actions {
                flex-direction: column;
                gap: 5px;
            }

            .task-actions .action-btn {
                width: 100%;
            }
        }

        /* æ—¶é—´é€‰æ‹©å™¨æ ·å¼ */
        .schedule-options {
            margin-top: 15px;
            padding: 15px;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            transition: var(--transition);
        }

        .schedule-options .form-group {
            margin-bottom: 10px;
        }

        .schedule-options .form-group:last-child {
            margin-bottom: 0;
        }

        .schedule-options label {
            font-size: 14px;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .schedule-options select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 14px;
        }

        .schedule-options select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
        }

        /* æ—¶é—´é€‰æ‹©å™¨åŠ¨ç”» */
        .schedule-options {
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ç´§å‡‘å¤´éƒ¨æ ·å¼ */
        .compact-header {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-left .app-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
            color: var(--primary-color);
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-light);
        }

        .breadcrumb-item {
            padding: 4px 8px;
            background: var(--bg-color);
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .header-right {
            display: flex;
            align-items: center;
        }

        .mini-actions {
            display: flex;
            gap: 8px;
        }

        .mini-btn {
            width: 32px;
            height: 32px;
            border: 1px solid var(--border-color);
            background: var(--bg-color);
            color: var(--text-color);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
        }

        .mini-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .mini-btn.danger:hover {
            background: #dc3545;
            border-color: #dc3545;
        }

        /* ç´§å‡‘å·¥å…·æ æ ·å¼ */
        .compact-toolbar {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px 16px;
            margin: 15px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toolbar-title {
            font-weight: 600;
            color: var(--text-color);
            font-size: 16px;
        }

        .action-group {
            display: flex;
            gap: 8px;
        }

        .action-group .action-btn {
            padding: 6px 12px;
            font-size: 14px;
            height: auto;
            min-height: 32px;
        }

        /* å¸®åŠ©å†…å®¹æ ·å¼ */
        .cron-help {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin: 15px 0;
            animation: slideDown 0.3s ease-out;
        }

        .help-content {
            color: var(--text-color);
        }

        .help-examples {
            margin-top: 12px;
            display: grid;
            gap: 8px;
        }

        .help-item {
            padding: 8px 12px;
            background: var(--bg-color);
            border-radius: 6px;
            border-left: 3px solid var(--primary-color);
            font-size: 14px;
        }

        .help-item strong {
            color: var(--primary-color);
        }

        /* è°ƒæ•´ä»»åŠ¡è¡¨å•æ ·å¼ */
        .task-section {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .compact-header {
                padding: 10px 15px;
                flex-direction: column;
                gap: 10px;
            }

            .header-left {
                width: 100%;
                justify-content: space-between;
            }

            .mini-actions {
                gap: 6px;
            }

            .mini-btn {
                width: 28px;
                height: 28px;
                font-size: 12px;
            }

            .compact-toolbar {
                padding: 10px 12px;
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .action-group {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <!-- ç´§å‡‘å¤´éƒ¨ -->
    <div class="compact-header">
        <div class="header-left">
            <h1 class="app-title">ğŸ“… MediaWarp ä»»åŠ¡è°ƒåº¦å™¨</h1>
            <div class="breadcrumb">
                <span class="breadcrumb-item">ä»»åŠ¡ç®¡ç†</span>
            </div>
        </div>
        <div class="header-right">
            <div class="mini-actions">
                <button class="mini-btn" onclick="goToSyncFolder()" title="æ–‡ä»¶åŒæ­¥">
                    <i class="fas fa-folder-open"></i>
                </button>
                <button class="mini-btn" onclick="refreshTasks()" title="åˆ·æ–°ä»»åŠ¡">
                    <i class="fas fa-refresh"></i>
                </button>
                <button class="mini-btn" id="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="mini-btn danger" onclick="logout()" title="ç™»å‡º">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="container">

        <!-- ç´§å‡‘æ“ä½œæ  -->
        <div class="compact-toolbar">
            <div class="nav-group">
                <span class="toolbar-title">
                    <i class="fas fa-plus-circle"></i>
                    æ·»åŠ æ–°ä»»åŠ¡
                </span>
            </div>
            <div class="action-group">
                <button class="action-btn" onclick="toggleCronHelp()" title="Cronå¸®åŠ©">
                    <i class="fas fa-question-circle"></i>
                </button>
                <button class="action-btn" onclick="clearForm()" title="æ¸…ç©ºè¡¨å•">
                    <i class="fas fa-eraser"></i>
                </button>
            </div>
        </div>

        <!-- Cronå¸®åŠ©ï¼ˆå¯æŠ˜å ï¼‰ -->
        <div class="cron-help" id="cron-help" style="display: none;">
            <div class="help-content">
                <strong>æ—¶é—´è®¾ç½®è¯´æ˜:</strong>
                <div class="help-examples">
                    <div class="help-item">
                        <strong>æ¯å°æ—¶æ‰§è¡Œ:</strong> é€‰æ‹©åˆ†é’Ÿæ•°ï¼ˆå¦‚æ•´ç‚¹ã€15åˆ†ã€30åˆ†ã€45åˆ†ï¼‰
                    </div>
                    <div class="help-item">
                        <strong>æ¯å¤©æ‰§è¡Œ:</strong> é€‰æ‹©å…·ä½“æ—¶é—´ï¼ˆå¦‚å‡Œæ™¨2ç‚¹ã€ä¸Šåˆ9ç‚¹ç­‰ï¼‰
                    </div>
                    <div class="help-item">
                        <strong>æ¯å‘¨æ‰§è¡Œ:</strong> é€‰æ‹©æ˜ŸæœŸå‡ å’Œå…·ä½“æ—¶é—´
                    </div>
                    <div class="help-item">
                        <strong>è‡ªå®šä¹‰:</strong> ä½¿ç”¨Cronè¡¨è¾¾å¼ï¼ˆæ ¼å¼ï¼šç§’ åˆ† æ—¶ æ—¥ æœˆ å‘¨ï¼‰
                    </div>
                </div>
            </div>
        </div>

        <div id="message-area"></div>

        <!-- ä»»åŠ¡è¡¨å•åŒºåŸŸ -->
        <div class="task-section">

            <form id="taskForm">
                <div class="form-group">
                    <label for="name">ğŸ“ ä»»åŠ¡åç§°</label>
                    <input type="text" id="name" name="name" placeholder="è¾“å…¥ä»»åŠ¡åç§°" required>
                </div>

                <div class="form-group">
                    <label for="schedule-type">â° æ‰§è¡Œæ—¶é—´</label>
                    <select id="schedule-type" name="schedule_type" required>
                        <option value="">è¯·é€‰æ‹©æ‰§è¡Œæ—¶é—´</option>
                        <option value="hourly">æ¯å°æ—¶æ‰§è¡Œ</option>
                        <option value="daily">æ¯å¤©æ‰§è¡Œ</option>
                        <option value="weekly">æ¯å‘¨æ‰§è¡Œ</option>
                        <option value="custom">è‡ªå®šä¹‰Cronè¡¨è¾¾å¼</option>
                    </select>
                </div>

                <!-- æ¯å°æ—¶æ‰§è¡Œé€‰é¡¹ -->
                <div id="hourly-options" class="schedule-options" style="display: none;">
                    <div class="form-group">
                        <label for="hourly-minute">æ‰§è¡Œåˆ†é’Ÿ:</label>
                        <select id="hourly-minute">
                            <option value="0">æ•´ç‚¹ (:00)</option>
                            <option value="15">15åˆ† (:15)</option>
                            <option value="30">30åˆ† (:30)</option>
                            <option value="45">45åˆ† (:45)</option>
                        </select>
                    </div>
                </div>

                <!-- æ¯å¤©æ‰§è¡Œé€‰é¡¹ -->
                <div id="daily-options" class="schedule-options" style="display: none;">
                    <div class="form-group">
                        <label for="daily-hour">æ‰§è¡Œæ—¶é—´:</label>
                        <select id="daily-hour">
                            <option value="0">å‡Œæ™¨ 00:00</option>
                            <option value="1">å‡Œæ™¨ 01:00</option>
                            <option value="2">å‡Œæ™¨ 02:00</option>
                            <option value="3">å‡Œæ™¨ 03:00</option>
                            <option value="6">æ—©ä¸Š 06:00</option>
                            <option value="9">ä¸Šåˆ 09:00</option>
                            <option value="12">ä¸­åˆ 12:00</option>
                            <option value="15">ä¸‹åˆ 15:00</option>
                            <option value="18">ä¸‹åˆ 18:00</option>
                            <option value="21">æ™šä¸Š 21:00</option>
                        </select>
                    </div>
                </div>

                <!-- æ¯å‘¨æ‰§è¡Œé€‰é¡¹ -->
                <div id="weekly-options" class="schedule-options" style="display: none;">
                    <div class="form-group">
                        <label for="weekly-day">æ‰§è¡Œæ—¥æœŸ:</label>
                        <select id="weekly-day">
                            <option value="0">å‘¨æ—¥</option>
                            <option value="1">å‘¨ä¸€</option>
                            <option value="2">å‘¨äºŒ</option>
                            <option value="3">å‘¨ä¸‰</option>
                            <option value="4">å‘¨å››</option>
                            <option value="5">å‘¨äº”</option>
                            <option value="6">å‘¨å…­</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="weekly-hour">æ‰§è¡Œæ—¶é—´:</label>
                        <select id="weekly-hour">
                            <option value="0">å‡Œæ™¨ 00:00</option>
                            <option value="2">å‡Œæ™¨ 02:00</option>
                            <option value="6">æ—©ä¸Š 06:00</option>
                            <option value="9">ä¸Šåˆ 09:00</option>
                            <option value="12">ä¸­åˆ 12:00</option>
                            <option value="18">ä¸‹åˆ 18:00</option>
                            <option value="21">æ™šä¸Š 21:00</option>
                        </select>
                    </div>
                </div>

                <!-- è‡ªå®šä¹‰Cronè¡¨è¾¾å¼ -->
                <div id="custom-options" class="schedule-options" style="display: none;">
                    <div class="form-group">
                        <label for="custom-cron">Cron è¡¨è¾¾å¼:</label>
                        <input type="text" id="custom-cron" placeholder="0 0 2 * * *">
                        <small>æ ¼å¼: ç§’ åˆ† æ—¶ æ—¥ æœˆ å‘¨ï¼Œä¾‹å¦‚ "0 0 2 * * *" è¡¨ç¤ºæ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ</small>
                    </div>
                </div>

                <!-- éšè—çš„å®é™…scheduleå­—æ®µ -->
                <input type="hidden" id="schedule" name="schedule">

                <div class="form-group">
                    <label for="function">âš™ï¸ é€‰æ‹©åŠŸèƒ½</label>
                    <select id="function" name="function" required>
                        <option value="">è¯·é€‰æ‹©è¦æ‰§è¡Œçš„åŠŸèƒ½...</option>
                    </select>
                </div>

                <div id="function-description" class="message warning-message" style="display: none;">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>å‡½æ•°è¯´æ˜:</strong>
                        <p id="description-text"></p>
                    </div>
                </div>

                <!-- è‡ªå®šä¹‰åŒæ­¥ä»»åŠ¡é…ç½® -->
                <div id="customSyncConfig" class="custom-sync-config" style="display: none;">
                    <h4>è‡ªå®šä¹‰åŒæ­¥é…ç½®</h4>

                    <div class="form-group">
                        <label for="sourcePath">æºè·¯å¾„:</label>
                        <input type="text" id="sourcePath" name="source_path" placeholder="115:/ç”µå½±/">
                        <small>æ ¼å¼: remote:pathï¼Œä¾‹å¦‚ 115:/ç”µå½±/</small>
                    </div>

                    <div class="form-group">
                        <label for="targetPath">ç›®æ ‡è·¯å¾„:</label>
                        <input type="text" id="targetPath" name="target_path" placeholder="/Users/user/data/media">
                        <small>æœ¬åœ°å­˜å‚¨è·¯å¾„</small>
                    </div>

                    <!-- åŒæ­¥é€‰é¡¹å’ŒRcloneè·¯å¾„å­—æ®µéšè—ï¼Œä½¿ç”¨å†…ç½®é»˜è®¤å‚æ•° -->
                    <input type="hidden" id="syncOptions" name="sync_options" value="min-size=100M,strm-format,sync-delete">
                    <input type="hidden" id="rclonePath" name="rclone_path" value="rclone">
                </div>

                <button type="submit" class="btn-primary">
                    <i class="fas fa-plus"></i> æ·»åŠ ä»»åŠ¡
                </button>
            </form>
        </div>

        <!-- ä»»åŠ¡ç®¡ç†å™¨çŠ¶æ€ -->
        <div class="compact-toolbar">
            <div class="nav-group">
                <span class="toolbar-title">
                    <i class="fas fa-cogs"></i>
                    ä»»åŠ¡ç®¡ç†å™¨çŠ¶æ€
                </span>
            </div>
        </div>

        <div id="task-manager-status" class="task-manager-status">
            <div class="status-loading">
                <i class="fas fa-spinner fa-spin"></i>
                æ­£åœ¨åŠ è½½ä»»åŠ¡ç®¡ç†å™¨çŠ¶æ€...
            </div>
        </div>

        <!-- ä»»åŠ¡åˆ—è¡¨ -->
        <div class="compact-toolbar">
            <div class="nav-group">
                <span class="toolbar-title">
                    <i class="fas fa-list"></i>
                    ä»»åŠ¡åˆ—è¡¨
                </span>
            </div>
            <div class="action-group">
                <button class="action-btn" onclick="refreshTasks()" title="åˆ·æ–°ä»»åŠ¡åˆ—è¡¨">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>

            <div id="loading" class="loading" style="display: none;">
                <i class="fas fa-spinner fa-spin"></i> åŠ è½½ä¸­...
            </div>

            <div class="task-list">
                <table id="taskTable" style="display: none;">
                    <thead>
                        <tr>
                            <th><i class="fas fa-tag"></i> ä»»åŠ¡åç§°</th>
                            <th><i class="fas fa-cog"></i> åŠŸèƒ½</th>
                            <th><i class="fas fa-clock"></i> Cron è¡¨è¾¾å¼</th>
                            <th><i class="fas fa-calendar-alt"></i> ä¸‹æ¬¡è¿è¡Œ</th>
                            <th><i class="fas fa-info-circle"></i> çŠ¶æ€</th>
                            <th><i class="fas fa-tools"></i> æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="taskTableBody">
                        <!-- Task rows will be inserted here -->
                    </tbody>
                </table>

                <div id="no-tasks" class="message" style="display: none; text-align: center; background-color: var(--card-bg); border: 2px dashed var(--border-color);">
                    <i class="fas fa-inbox"></i>
                    <div>
                        <strong>æš‚æ— ä»»åŠ¡</strong>
                        <p style="margin-top: 5px; color: var(--text-light);">æ·»åŠ ç¬¬ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å¼€å§‹è‡ªåŠ¨åŒ–ç®¡ç†</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        const themeToggle = document.getElementById('theme-toggle');
        const icon = themeToggle.querySelector('i');

        // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­çš„ä¸»é¢˜è®¾ç½®
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
            icon.classList.remove('fa-moon');
            icon.classList.add('fa-sun');
        }

        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');

            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                localStorage.setItem('darkMode', 'true');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                localStorage.setItem('darkMode', 'false');
            }
        });

        // è·³è½¬åˆ°æ–‡ä»¶åŒæ­¥é¡µé¢
        function goToSyncFolder() {
            const apiKey = localStorage.getItem('apiKey');
            if (!apiKey) {
                showMessage('æœªæˆæƒï¼šè¯·é‡æ–°ç™»å½•', 'error');
                window.location.href = "/login";
                return;
            }
            window.location.href = `/syncfolder?apiKey=${encodeURIComponent(apiKey)}`;
        }

        // åˆ·æ–°ä»»åŠ¡åˆ—è¡¨
        function refreshTasks() {
            const apiKey = localStorage.getItem('apiKey');
            if (apiKey) {
                loadTasks(apiKey);
                showMessage('ä»»åŠ¡åˆ—è¡¨å·²åˆ·æ–°', 'success');
            }
        }

        // åˆ‡æ¢Cronå¸®åŠ©æ˜¾ç¤º
        function toggleCronHelp() {
            const cronHelp = document.getElementById('cron-help');
            if (cronHelp.style.display === 'none') {
                cronHelp.style.display = 'block';
                showMessage('æ˜¾ç¤ºæ—¶é—´è®¾ç½®å¸®åŠ©', 'info');
            } else {
                cronHelp.style.display = 'none';
                showMessage('éšè—æ—¶é—´è®¾ç½®å¸®åŠ©', 'info');
            }
        }

        // æ¸…ç©ºè¡¨å•
        function clearForm() {
            const form = document.getElementById('taskForm');
            if (form) {
                form.reset();
                // éšè—æ‰€æœ‰æ—¶é—´é€‰æ‹©å™¨é€‰é¡¹
                document.querySelectorAll('.schedule-options').forEach(option => {
                    option.style.display = 'none';
                });
                // éšè—è‡ªå®šä¹‰åŒæ­¥é…ç½®
                const customSyncConfig = document.getElementById('customSyncConfig');
                if (customSyncConfig) {
                    customSyncConfig.style.display = 'none';
                }
                // éšè—åŠŸèƒ½æè¿°
                const functionDescription = document.getElementById('function-description');
                if (functionDescription) {
                    functionDescription.style.display = 'none';
                }
                // é‡ç½®éšè—çš„åŒæ­¥é€‰é¡¹å’ŒRcloneè·¯å¾„å­—æ®µä¸ºé»˜è®¤å€¼
                const syncOptionsField = document.getElementById('syncOptions');
                if (syncOptionsField) {
                    syncOptionsField.value = 'min-size=100M,strm-format,sync-delete';
                }

                const rclonePathField = document.getElementById('rclonePath');
                if (rclonePathField) {
                    rclonePathField.value = 'rclone';
                }
                showMessage('è¡¨å•å·²æ¸…ç©º', 'success');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const taskForm = document.getElementById('taskForm');
            const taskTableBody = document.getElementById('taskTableBody');
            const functionSelect = document.getElementById('function');
            const functionDescription = document.getElementById('function-description');
            const messageArea = document.getElementById('message-area');
            const loadingDiv = document.getElementById('loading');
            const taskTable = document.getElementById('taskTable');
            const noTasksDiv = document.getElementById('no-tasks');

            // è·å–APIå¯†é’¥ - ä¼˜å…ˆçº§ï¼šURLå‚æ•° > æ¨¡æ¿å˜é‡ > localStorage
            let apiKey = getApiKeyFromUrl() || '{{.apiKey}}' || localStorage.getItem('apiKey');

            console.log('Taské¡µé¢è®¤è¯æ£€æŸ¥:');
            console.log('- URLå‚æ•°apiKey:', getApiKeyFromUrl());
            console.log('- æ¨¡æ¿å˜é‡apiKey:', '{{.apiKey}}');
            console.log('- localStorage apiKey:', localStorage.getItem('apiKey'));
            console.log('- æœ€ç»ˆä½¿ç”¨çš„apiKey:', apiKey);

            // æ¸…ç†æ¨¡æ¿å˜é‡ï¼ˆå¦‚æœæ²¡æœ‰ä¼ é€’ï¼‰
            if (apiKey === '{{.apiKey}}') {
                apiKey = '';
                console.log('- æ¸…ç†æ¨¡æ¿å˜é‡åçš„apiKey:', apiKey);
            }

            if (!apiKey) {
                console.log('- è®¤è¯å¤±è´¥ï¼šæ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„API Key');
                showMessage('æœªæˆæƒï¼šè¯·é‡æ–°ç™»å½•', 'error');
                setTimeout(() => {
                    window.location.href = "/login";
                }, 2000);
                return;
            }

            console.log('- è®¤è¯æˆåŠŸï¼Œç»§ç»­åŠ è½½é¡µé¢');

            // ä¿å­˜APIå¯†é’¥åˆ°localStorage
            localStorage.setItem('apiKey', apiKey);

            // Load available functions
            loadFunctions(apiKey);

            // Fetch and display tasks when page loads
            fetchTasks(apiKey);

            // Fetch and display task manager status
            fetchTaskManagerStatus(apiKey);

            // å®šæœŸæ›´æ–°TaskManagerçŠ¶æ€ï¼ˆæ¯5ç§’ï¼‰
            setInterval(() => {
                fetchTaskManagerStatus(apiKey);
            }, 5000);

            // æ£€æŸ¥æ˜¯å¦æœ‰æ¥è‡ªsyncfolderé¡µé¢çš„é¢„å¡«å……é…ç½®
            checkPendingTaskConfig();

            // Function selection change handler
            functionSelect.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                const descriptionText = document.getElementById('description-text');
                const customSyncConfig = document.getElementById('customSyncConfig');

                if (selectedOption.dataset.description) {
                    descriptionText.textContent = selectedOption.dataset.description;
                    functionDescription.style.display = 'flex';
                } else {
                    functionDescription.style.display = 'none';
                }

                // æ˜¾ç¤º/éšè—è‡ªå®šä¹‰åŒæ­¥é…ç½®
                if (this.value === 'custom_sync') {
                    customSyncConfig.style.display = 'block';
                } else {
                    customSyncConfig.style.display = 'none';
                }
            });

            // æ—¶é—´é€‰æ‹©å™¨å¤„ç†
            const scheduleTypeSelect = document.getElementById('schedule-type');
            const scheduleOptions = document.querySelectorAll('.schedule-options');
            const scheduleInput = document.getElementById('schedule');

            scheduleTypeSelect.addEventListener('change', function() {
                // éšè—æ‰€æœ‰é€‰é¡¹
                scheduleOptions.forEach(option => {
                    option.style.display = 'none';
                });

                // æ˜¾ç¤ºé€‰ä¸­çš„é€‰é¡¹
                const selectedType = this.value;
                if (selectedType) {
                    const targetOption = document.getElementById(selectedType + '-options');
                    if (targetOption) {
                        targetOption.style.display = 'block';
                    }
                }

                // ç”ŸæˆCronè¡¨è¾¾å¼
                generateCronExpression();
            });

            // ç›‘å¬æ—¶é—´é€‰æ‹©å™¨çš„å˜åŒ–
            document.getElementById('hourly-minute').addEventListener('change', generateCronExpression);
            document.getElementById('daily-hour').addEventListener('change', generateCronExpression);
            document.getElementById('weekly-day').addEventListener('change', generateCronExpression);
            document.getElementById('weekly-hour').addEventListener('change', generateCronExpression);
            document.getElementById('custom-cron').addEventListener('input', function() {
                scheduleInput.value = this.value;
            });

            // ç”ŸæˆCronè¡¨è¾¾å¼å‡½æ•°
            function generateCronExpression() {
                const scheduleType = scheduleTypeSelect.value;
                let cronExpression = '';

                switch (scheduleType) {
                    case 'hourly':
                        const minute = document.getElementById('hourly-minute').value;
                        cronExpression = `0 ${minute} * * * *`;
                        break;

                    case 'daily':
                        const hour = document.getElementById('daily-hour').value;
                        cronExpression = `0 0 ${hour} * * *`;
                        break;

                    case 'weekly':
                        const weekDay = document.getElementById('weekly-day').value;
                        const weekHour = document.getElementById('weekly-hour').value;
                        cronExpression = `0 0 ${weekHour} * * ${weekDay}`;
                        break;

                    case 'custom':
                        cronExpression = document.getElementById('custom-cron').value;
                        break;
                }

                scheduleInput.value = cronExpression;
            }

            // è§£æCronè¡¨è¾¾å¼å¹¶è®¾ç½®æ—¶é—´é€‰æ‹©å™¨
            function parseAndSetSchedule(cronExpression) {
                if (!cronExpression) return;

                const parts = cronExpression.split(' ');
                if (parts.length !== 6) return;

                const [second, minute, hour, day, month, weekday] = parts;

                // æ£€æŸ¥æ˜¯å¦æ˜¯æ¯å°æ—¶æ‰§è¡Œ (0 X * * * *)
                if (second === '0' && hour === '*' && day === '*' && month === '*' && weekday === '*') {
                    document.getElementById('schedule-type').value = 'hourly';
                    document.getElementById('hourly-minute').value = minute;
                    scheduleTypeSelect.dispatchEvent(new Event('change'));
                    return;
                }

                // æ£€æŸ¥æ˜¯å¦æ˜¯æ¯å¤©æ‰§è¡Œ (0 0 X * * *)
                if (second === '0' && minute === '0' && day === '*' && month === '*' && weekday === '*') {
                    document.getElementById('schedule-type').value = 'daily';
                    document.getElementById('daily-hour').value = hour;
                    scheduleTypeSelect.dispatchEvent(new Event('change'));
                    return;
                }

                // æ£€æŸ¥æ˜¯å¦æ˜¯æ¯å‘¨æ‰§è¡Œ (0 0 X * * Y)
                if (second === '0' && minute === '0' && day === '*' && month === '*' && weekday !== '*') {
                    document.getElementById('schedule-type').value = 'weekly';
                    document.getElementById('weekly-hour').value = hour;
                    document.getElementById('weekly-day').value = weekday;
                    scheduleTypeSelect.dispatchEvent(new Event('change'));
                    return;
                }

                // å…¶ä»–æƒ…å†µä½¿ç”¨è‡ªå®šä¹‰
                document.getElementById('schedule-type').value = 'custom';
                document.getElementById('custom-cron').value = cronExpression;
                scheduleTypeSelect.dispatchEvent(new Event('change'));
            }

            taskForm.addEventListener('submit', function(event) {
                event.preventDefault();

                const taskData = {
                    name: document.getElementById('name').value.trim(),
                    schedule: document.getElementById('schedule').value.trim(),
                    function: document.getElementById('function').value
                };

                // å¦‚æœæ˜¯è‡ªå®šä¹‰åŒæ­¥ä»»åŠ¡ï¼Œæ·»åŠ è‡ªå®šä¹‰å‚æ•°
                if (taskData.function === 'custom_sync') {
                    const sourcePath = document.getElementById('sourcePath').value.trim();
                    const targetPath = document.getElementById('targetPath').value.trim();
                    const syncOptions = document.getElementById('syncOptions').value.trim();
                    const rclonePath = document.getElementById('rclonePath').value.trim();

                    // éªŒè¯è‡ªå®šä¹‰åŒæ­¥å‚æ•°
                    if (!sourcePath || !targetPath) {
                        showMessage('è‡ªå®šä¹‰åŒæ­¥ä»»åŠ¡éœ€è¦å¡«å†™æºè·¯å¾„å’Œç›®æ ‡è·¯å¾„', 'error');
                        return;
                    }

                    if (!sourcePath.includes(':')) {
                        showMessage('æºè·¯å¾„æ ¼å¼é”™è¯¯ï¼Œåº”ä¸º "remote:path" æ ¼å¼', 'error');
                        return;
                    }

                    taskData.task_type = 'custom_sync';
                    taskData.custom_params = {
                        source_path: sourcePath,
                        target_path: targetPath,
                        sync_options: syncOptions ? syncOptions.split(',').map(opt => opt.trim()) : [],
                        rclone_path: rclonePath || 'rclone'
                    };
                } else {
                    taskData.task_type = 'predefined';
                }

                // åŸºæœ¬éªŒè¯
                if (!taskData.name || !taskData.schedule || !taskData.function) {
                    showMessage('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ', 'error');
                    return;
                }

                // ç¦ç”¨æäº¤æŒ‰é’®
                const submitBtn = taskForm.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.disabled = true;
                submitBtn.textContent = 'ä¿å­˜ä¸­...';

                // æ ¹æ®ä»»åŠ¡ç±»å‹é€‰æ‹©APIç«¯ç‚¹
                const endpoint = taskData.task_type === 'custom_sync' ? '/task/custom-sync' : '/task';

                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': apiKey
                    },
                    body: JSON.stringify(taskData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showMessage(`é”™è¯¯: ${data.error}`, 'error');
                    } else {
                        showMessage(`ä»»åŠ¡ "${data.task_name}" å·²ä¿å­˜æˆåŠŸ`, 'success');
                        taskForm.reset();
                        functionDescription.style.display = 'none';
                        document.getElementById('customSyncConfig').style.display = 'none';
                        fetchTasks(apiKey);
                        fetchTaskManagerStatus(apiKey);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showMessage('ä¿å­˜ä»»åŠ¡æ—¶å‘ç”Ÿé”™è¯¯', 'error');
                })
                .finally(() => {
                    // æ¢å¤æäº¤æŒ‰é’®
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                });
            });

            // ä»URLå‚æ•°è·å–APIå¯†é’¥
            function getApiKeyFromUrl() {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('apiKey');
            }

            // æ˜¾ç¤ºæ¶ˆæ¯
            function showMessage(message, type) {
                let icon = '';
                switch(type) {
                    case 'success':
                        icon = '<i class="fas fa-check-circle"></i>';
                        break;
                    case 'error':
                        icon = '<i class="fas fa-exclamation-circle"></i>';
                        break;
                    case 'warning':
                        icon = '<i class="fas fa-exclamation-triangle"></i>';
                        break;
                    default:
                        icon = '<i class="fas fa-info-circle"></i>';
                }

                messageArea.innerHTML = `<div class="message ${type}-message">${icon}<span>${message}</span></div>`;
                setTimeout(() => {
                    messageArea.innerHTML = '';
                }, 5000);
            }

            // åŠ è½½å¯ç”¨å‡½æ•°
            function loadFunctions(apiKey) {
                fetch('/task/functions', {
                    headers: {
                        'X-API-Key': apiKey
                    }
                })
                .then(response => response.json())
                .then(functions => {
                    functionSelect.innerHTML = '<option value="">è¯·é€‰æ‹©åŠŸèƒ½...</option>';
                    functions.forEach(func => {
                        const option = document.createElement('option');
                        option.value = func.key;
                        option.textContent = func.description;
                        option.dataset.description = func.description;
                        functionSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error loading functions:', error);
                    showMessage('åŠ è½½åŠŸèƒ½åˆ—è¡¨å¤±è´¥', 'error');
                });
            }

            // æ ¼å¼åŒ–æ—¶é—´
            function formatTime(timeStr) {
                if (!timeStr) return '-';
                try {
                    const date = new Date(timeStr);
                    return date.toLocaleString('zh-CN');
                } catch (e) {
                    return timeStr;
                }
            }

            function fetchTasks(apiKey) {
                loadingDiv.style.display = 'block';
                taskTable.style.display = 'none';
                noTasksDiv.style.display = 'none';

                fetch('/tasks', {
                    headers: {
                        'X-API-Key': apiKey
                    }
                })
                .then(response => response.json())
                .then(tasks => {
                    loadingDiv.style.display = 'none';

                    if (tasks.length === 0) {
                        noTasksDiv.style.display = 'block';
                        return;
                    }

                    taskTable.style.display = 'table';
                    taskTableBody.innerHTML = '';

                    tasks.forEach(task => {
                        const row = document.createElement('tr');

                        // ä»»åŠ¡åç§°
                        const nameCell = document.createElement('td');
                        nameCell.textContent = task.name;
                        row.appendChild(nameCell);

                        // åŠŸèƒ½æè¿°
                        const functionCell = document.createElement('td');
                        functionCell.textContent = task.description || task.function;
                        row.appendChild(functionCell);

                        // Cron è¡¨è¾¾å¼
                        const scheduleCell = document.createElement('td');
                        scheduleCell.innerHTML = `<code>${task.schedule}</code>`;
                        row.appendChild(scheduleCell);

                        // ä¸‹æ¬¡è¿è¡Œæ—¶é—´
                        const nextRunCell = document.createElement('td');
                        nextRunCell.textContent = formatTime(task.next_run);
                        row.appendChild(nextRunCell);

                        // çŠ¶æ€
                        const statusCell = document.createElement('td');
                        const statusSpan = document.createElement('span');
                        statusSpan.className = `task-status status-${task.status || 'active'}`;
                        statusSpan.textContent = task.status === 'active' ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢';
                        statusCell.appendChild(statusSpan);
                        row.appendChild(statusCell);

                        // æ“ä½œ
                        const actionsCell = document.createElement('td');
                        actionsCell.className = 'task-actions';

                        // ç¼–è¾‘æŒ‰é’®
                        const editButton = document.createElement('button');
                        editButton.innerHTML = '<i class="fas fa-edit"></i> ç¼–è¾‘';
                        editButton.className = 'action-btn';
                        editButton.onclick = () => openEditModal(task);
                        actionsCell.appendChild(editButton);

                        // åˆ é™¤æŒ‰é’®
                        const deleteButton = document.createElement('button');
                        deleteButton.innerHTML = '<i class="fas fa-trash"></i> åˆ é™¤';
                        deleteButton.className = 'action-btn danger';
                        deleteButton.onclick = () => deleteTask(task.name, apiKey);
                        actionsCell.appendChild(deleteButton);

                        row.appendChild(actionsCell);
                        taskTableBody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                    loadingDiv.style.display = 'none';
                    showMessage('åŠ è½½ä»»åŠ¡åˆ—è¡¨å¤±è´¥', 'error');
                });
            }

            function deleteTask(taskName, apiKey) {
                if (confirm(`ç¡®å®šè¦åˆ é™¤ä»»åŠ¡ "${taskName}" å—ï¼Ÿ\n\næ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)) {
                    fetch(`/task/${taskName}`, {
                        method: 'DELETE',
                        headers: {
                            'X-API-Key': apiKey
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            showMessage(`åˆ é™¤å¤±è´¥: ${data.error}`, 'error');
                        } else {
                            showMessage(`ä»»åŠ¡ "${data.task_name}" å·²åˆ é™¤`, 'success');
                            fetchTasks(apiKey);
                            fetchTaskManagerStatus(apiKey);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showMessage('åˆ é™¤ä»»åŠ¡æ—¶å‘ç”Ÿé”™è¯¯', 'error');
                    });
                }
            }

            // è·å–TaskManagerçŠ¶æ€
            function fetchTaskManagerStatus(apiKey) {
                fetch('/task/manager/status', {
                    headers: {
                        'X-API-Key': apiKey
                    }
                })
                .then(response => response.json())
                .then(data => {
                    displayTaskManagerStatus(data);
                })
                .catch(error => {
                    console.error('Error fetching task manager status:', error);
                    displayTaskManagerError();
                });
            }

            // æ˜¾ç¤ºTaskManagerçŠ¶æ€
            function displayTaskManagerStatus(status) {
                const statusContainer = document.getElementById('task-manager-status');

                if (status.running) {
                    // æ­£åœ¨è¿è¡ŒçŠ¶æ€
                    statusContainer.innerHTML = `
                        <div class="status-running">
                            <div class="current-task">
                                <h4><i class="fas fa-play-circle"></i> æ­£åœ¨æ‰§è¡Œ</h4>
                                <div class="task-name">${status.current_task}</div>
                                <div class="task-info">
                                    ${status.start_time ? `å¼€å§‹æ—¶é—´: ${status.start_time}` : ''}
                                    ${status.duration ? ` | è¿è¡Œæ—¶é•¿: ${status.duration}` : ''}
                                </div>
                            </div>
                            <div class="task-queue">
                                <h4><i class="fas fa-list"></i> ç­‰å¾…é˜Ÿåˆ— (${status.queue_length})</h4>
                                ${status.queue_length > 0 ?
                                    `<ul class="queue-list">
                                        ${status.queued_tasks.map((task, index) =>
                                            `<li class="queue-item">
                                                <span class="item-number">${index + 1}.</span>
                                                ${task}
                                            </li>`
                                        ).join('')}
                                    </ul>` :
                                    '<div class="queue-empty">æš‚æ— ç­‰å¾…ä»»åŠ¡</div>'
                                }
                            </div>
                        </div>
                    `;
                } else {
                    // ç©ºé—²çŠ¶æ€
                    statusContainer.innerHTML = `
                        <div class="status-idle">
                            <i class="fas fa-check-circle"></i>
                            <div>ä»»åŠ¡ç®¡ç†å™¨ç©ºé—²</div>
                            <div style="font-size: 0.9rem; margin-top: 5px;">æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼Œç­‰å¾…æ–°ä»»åŠ¡...</div>
                        </div>
                    `;
                }
            }

            // æ˜¾ç¤ºTaskManageré”™è¯¯çŠ¶æ€
            function displayTaskManagerError() {
                const statusContainer = document.getElementById('task-manager-status');
                statusContainer.innerHTML = `
                    <div class="status-loading">
                        <i class="fas fa-exclamation-triangle" style="color: var(--error-color);"></i>
                        æ— æ³•è·å–ä»»åŠ¡ç®¡ç†å™¨çŠ¶æ€
                    </div>
                `;
            }

            // è·³è½¬åˆ°æ–‡ä»¶åŒæ­¥é¡µé¢
            window.goToSyncFolder = function() {
                window.location.href = '/syncfolder';
            }

            // åˆ·æ–°ä»»åŠ¡åˆ—è¡¨
            window.refreshTasks = function() {
                fetchTasks(apiKey);
                fetchTaskManagerStatus(apiKey);
                showMessage('ä»»åŠ¡åˆ—è¡¨å·²åˆ·æ–°', 'success');
            }

            // æ‰“å¼€ç¼–è¾‘æ¨¡æ€æ¡†
            window.openEditModal = function(task) {
                const modal = document.getElementById('editModal');
                const form = document.getElementById('editTaskForm');
                const functionSelect = document.getElementById('editTaskFunction');
                const customSyncConfig = document.getElementById('editCustomSyncConfig');

                // å¡«å……åŸºæœ¬ä¿¡æ¯
                document.getElementById('editTaskName').value = task.name;
                document.getElementById('editTaskSchedule').value = task.schedule;
                document.getElementById('editTaskDescription').value = task.description || '';

                // åŠ è½½åŠŸèƒ½é€‰é¡¹
                loadFunctionOptions(functionSelect, task.function);

                // å¦‚æœæ˜¯è‡ªå®šä¹‰åŒæ­¥ä»»åŠ¡ï¼Œæ˜¾ç¤ºé…ç½®ç•Œé¢
                if (task.task_type === 'custom_sync' && task.custom_params) {
                    customSyncConfig.style.display = 'block';
                    document.getElementById('editSourcePath').value = task.custom_params.source_path || '';
                    document.getElementById('editTargetPath').value = task.custom_params.target_path || '';
                    document.getElementById('editSyncOptions').value = (task.custom_params.sync_options || []).join(',');
                    document.getElementById('editRclonePath').value = task.custom_params.rclone_path || 'rclone';
                } else {
                    customSyncConfig.style.display = 'none';
                }

                // å­˜å‚¨åŸå§‹ä»»åŠ¡åç§°ç”¨äºAPIè°ƒç”¨
                form.dataset.originalName = task.name;

                modal.style.display = 'block';
            }

            // å…³é—­ç¼–è¾‘æ¨¡æ€æ¡†
            window.closeEditModal = function() {
                const modal = document.getElementById('editModal');
                modal.style.display = 'none';
            }

            // åŠ è½½åŠŸèƒ½é€‰é¡¹åˆ°é€‰æ‹©æ¡†
            function loadFunctionOptions(selectElement, selectedValue) {
                fetch('/task/functions', {
                    headers: {
                        'X-API-Key': apiKey
                    }
                })
                .then(response => response.json())
                .then(functions => {
                    selectElement.innerHTML = '<option value="">è¯·é€‰æ‹©åŠŸèƒ½</option>';

                    // æ·»åŠ é¢„å®šä¹‰åŠŸèƒ½
                    Object.keys(functions).forEach(funcName => {
                        const option = document.createElement('option');
                        option.value = funcName;
                        option.textContent = functions[funcName];
                        if (funcName === selectedValue) {
                            option.selected = true;
                        }
                        selectElement.appendChild(option);
                    });

                    // æ·»åŠ è‡ªå®šä¹‰åŒæ­¥é€‰é¡¹
                    const customOption = document.createElement('option');
                    customOption.value = 'custom_sync';
                    customOption.textContent = 'è‡ªå®šä¹‰åŒæ­¥ä»»åŠ¡';
                    if (selectedValue === 'custom_sync') {
                        customOption.selected = true;
                    }
                    selectElement.appendChild(customOption);
                })
                .catch(error => {
                    console.error('Error loading functions:', error);
                    showMessage('åŠ è½½åŠŸèƒ½åˆ—è¡¨å¤±è´¥', 'error');
                });
            }

            // ç›‘å¬åŠŸèƒ½é€‰æ‹©å˜åŒ–
            document.getElementById('editTaskFunction').addEventListener('change', function() {
                const customSyncConfig = document.getElementById('editCustomSyncConfig');
                if (this.value === 'custom_sync') {
                    customSyncConfig.style.display = 'block';
                } else {
                    customSyncConfig.style.display = 'none';
                }
            });

            // éªŒè¯ç¼–è¾‘è¡¨å•
            function validateEditForm(formData) {
                const errors = [];

                // éªŒè¯ä»»åŠ¡åç§°
                const name = formData.get('name');
                if (!name || name.trim() === '') {
                    errors.push('ä»»åŠ¡åç§°ä¸èƒ½ä¸ºç©º');
                }

                // éªŒè¯Cronè¡¨è¾¾å¼
                const schedule = formData.get('schedule');
                if (!schedule || schedule.trim() === '') {
                    errors.push('Cronè¡¨è¾¾å¼ä¸èƒ½ä¸ºç©º');
                }

                // éªŒè¯åŠŸèƒ½é€‰æ‹©
                const func = formData.get('function');
                if (!func || func === '') {
                    errors.push('è¯·é€‰æ‹©åŠŸèƒ½');
                }

                // å¦‚æœæ˜¯è‡ªå®šä¹‰åŒæ­¥ä»»åŠ¡ï¼ŒéªŒè¯è‡ªå®šä¹‰å‚æ•°
                if (func === 'custom_sync') {
                    const sourcePath = formData.get('source_path');
                    const targetPath = formData.get('target_path');

                    if (!sourcePath || sourcePath.trim() === '') {
                        errors.push('æºè·¯å¾„ä¸èƒ½ä¸ºç©º');
                    } else if (!sourcePath.includes(':')) {
                        errors.push('æºè·¯å¾„æ ¼å¼é”™è¯¯ï¼Œåº”ä¸º "remote:path" æ ¼å¼');
                    }

                    if (!targetPath || targetPath.trim() === '') {
                        errors.push('ç›®æ ‡è·¯å¾„ä¸èƒ½ä¸ºç©º');
                    }
                }

                return errors;
            }

            // å¤„ç†ç¼–è¾‘è¡¨å•æäº¤
            document.getElementById('editTaskForm').addEventListener('submit', function(e) {
                e.preventDefault();

                const formData = new FormData(this);
                const originalName = this.dataset.originalName;

                // éªŒè¯è¡¨å•
                const errors = validateEditForm(formData);
                if (errors.length > 0) {
                    showMessage('è¡¨å•éªŒè¯å¤±è´¥ï¼š' + errors.join('ï¼Œ'), 'error');
                    return;
                }

                // æ„å»ºä»»åŠ¡æ•°æ®
                const taskData = {
                    name: formData.get('name'),
                    schedule: formData.get('schedule'),
                    function: formData.get('function'),
                    description: formData.get('description'),
                    task_type: formData.get('function') === 'custom_sync' ? 'custom_sync' : 'predefined'
                };

                // å¦‚æœæ˜¯è‡ªå®šä¹‰åŒæ­¥ä»»åŠ¡ï¼Œæ·»åŠ è‡ªå®šä¹‰å‚æ•°
                if (formData.get('function') === 'custom_sync') {
                    const syncOptions = formData.get('sync_options');
                    taskData.custom_params = {
                        source_path: formData.get('source_path'),
                        target_path: formData.get('target_path'),
                        sync_options: syncOptions ? syncOptions.split(',').map(opt => opt.trim()) : [],
                        rclone_path: formData.get('rclone_path') || 'rclone'
                    };
                }

                // å‘é€æ›´æ–°è¯·æ±‚
                fetch(`/task/${originalName}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': apiKey
                    },
                    body: JSON.stringify(taskData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showMessage(data.error, 'error');
                    } else {
                        showMessage(`ä»»åŠ¡ "${data.task_name}" å·²æ›´æ–°æˆåŠŸ`, 'success');
                        closeEditModal();
                        fetchTasks(apiKey);
                        fetchTaskManagerStatus(apiKey);
                    }
                })
                .catch(error => {
                    console.error('Error updating task:', error);
                    showMessage('æ›´æ–°ä»»åŠ¡å¤±è´¥', 'error');
                });
            });

            // ç›‘å¬åŠŸèƒ½é€‰æ‹©å˜åŒ–
            document.getElementById('editTaskFunction').addEventListener('change', function() {
                const customSyncConfig = document.getElementById('editCustomSyncConfig');
                if (this.value === 'custom_sync') {
                    customSyncConfig.style.display = 'block';
                } else {
                    customSyncConfig.style.display = 'none';
                }
            });

            // å¤„ç†ç¼–è¾‘è¡¨å•æäº¤
            document.getElementById('editTaskForm').addEventListener('submit', function(e) {
                e.preventDefault();

                const formData = new FormData(this);
                const originalName = this.dataset.originalName;

                // æ„å»ºä»»åŠ¡æ•°æ®
                const taskData = {
                    name: formData.get('name'),
                    schedule: formData.get('schedule'),
                    function: formData.get('function'),
                    description: formData.get('description'),
                    task_type: formData.get('function') === 'custom_sync' ? 'custom_sync' : 'predefined'
                };

                // å¦‚æœæ˜¯è‡ªå®šä¹‰åŒæ­¥ä»»åŠ¡ï¼Œæ·»åŠ è‡ªå®šä¹‰å‚æ•°
                if (formData.get('function') === 'custom_sync') {
                    const syncOptions = formData.get('sync_options');
                    taskData.custom_params = {
                        source_path: formData.get('source_path'),
                        target_path: formData.get('target_path'),
                        sync_options: syncOptions ? syncOptions.split(',').map(opt => opt.trim()) : [],
                        rclone_path: formData.get('rclone_path') || 'rclone'
                    };
                }

                // å‘é€æ›´æ–°è¯·æ±‚
                fetch(`/task/${originalName}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': apiKey
                    },
                    body: JSON.stringify(taskData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showMessage(data.error, 'error');
                    } else {
                        showMessage(`ä»»åŠ¡ "${data.task_name}" å·²æ›´æ–°æˆåŠŸ`, 'success');
                        closeEditModal();
                        fetchTasks(apiKey);
                        fetchTaskManagerStatus(apiKey);
                    }
                })
                .catch(error => {
                    console.error('Error updating task:', error);
                    showMessage('æ›´æ–°ä»»åŠ¡å¤±è´¥', 'error');
                });
            });

            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('editModal');
                if (event.target === modal) {
                    closeEditModal();
                }
            });

            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('editModal');
                if (event.target === modal) {
                    closeEditModal();
                }
            });

            // æ£€æŸ¥å¹¶å¤„ç†æ¥è‡ªsyncfolderé¡µé¢çš„é¢„å¡«å……é…ç½®
            function checkPendingTaskConfig() {
                const pendingConfig = localStorage.getItem('pendingTaskConfig');
                if (pendingConfig) {
                    try {
                        const taskConfig = JSON.parse(pendingConfig);

                        // æ¸…é™¤localStorageä¸­çš„é…ç½®
                        localStorage.removeItem('pendingTaskConfig');

                        // é¢„å¡«å……è¡¨å•
                        prefillTaskForm(taskConfig);

                        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                        showMessage('å·²ä»æ–‡ä»¶å¤¹åŒæ­¥é¡µé¢å¯¼å…¥ä»»åŠ¡é…ç½®ï¼Œè¯·æ£€æŸ¥å¹¶æäº¤', 'info');

                    } catch (error) {
                        console.error('è§£æé¢„å¡«å……é…ç½®å¤±è´¥:', error);
                        localStorage.removeItem('pendingTaskConfig');
                    }
                }
            }

            // é¢„å¡«å……ä»»åŠ¡è¡¨å•
            function prefillTaskForm(taskConfig) {
                console.log('å¼€å§‹é¢„å¡«å……è¡¨å•ï¼Œé…ç½®:', taskConfig);

                // å¡«å……åŸºæœ¬ä¿¡æ¯
                const nameField = document.getElementById('name');
                const scheduleField = document.getElementById('schedule');
                const functionField = document.getElementById('function');

                if (nameField) {
                    nameField.value = taskConfig.name || '';
                    console.log('å¡«å……ä»»åŠ¡åç§°:', taskConfig.name);
                }

                if (scheduleField) {
                    scheduleField.value = taskConfig.schedule || '';
                    console.log('å¡«å……Cronè¡¨è¾¾å¼:', taskConfig.schedule);

                    // å°è¯•è§£æCronè¡¨è¾¾å¼å¹¶è®¾ç½®æ—¶é—´é€‰æ‹©å™¨
                    parseAndSetSchedule(taskConfig.schedule || '');
                }

                if (functionField) {
                    functionField.value = taskConfig.function || '';
                    console.log('å¡«å……åŠŸèƒ½é€‰æ‹©:', taskConfig.function);

                    // è§¦å‘åŠŸèƒ½é€‰æ‹©å˜åŒ–äº‹ä»¶
                    functionField.dispatchEvent(new Event('change'));
                }

                // å¦‚æœæ˜¯è‡ªå®šä¹‰åŒæ­¥ä»»åŠ¡ï¼Œå¡«å……è‡ªå®šä¹‰å‚æ•°
                if (taskConfig.task_type === 'custom_sync' && taskConfig.custom_params) {
                    console.log('å¡«å……è‡ªå®šä¹‰åŒæ­¥å‚æ•°:', taskConfig.custom_params);
                    setTimeout(() => {
                        const customParams = taskConfig.custom_params;

                        const sourcePathField = document.getElementById('sourcePath');
                        const targetPathField = document.getElementById('targetPath');
                        const syncOptionsField = document.getElementById('syncOptions');
                        const rclonePathField = document.getElementById('rclonePath');

                        if (sourcePathField) {
                            sourcePathField.value = customParams.source_path || '';
                            console.log('å¡«å……æºè·¯å¾„:', customParams.source_path);
                        }

                        if (targetPathField) {
                            targetPathField.value = customParams.target_path || '';
                            console.log('å¡«å……ç›®æ ‡è·¯å¾„:', customParams.target_path);
                        }

                        // åŒæ­¥é€‰é¡¹å’ŒRcloneè·¯å¾„ä½¿ç”¨å†…ç½®é»˜è®¤å‚æ•°ï¼Œä¸éœ€è¦ç”¨æˆ·é…ç½®
                        if (syncOptionsField) {
                            syncOptionsField.value = 'min-size=100M,strm-format,sync-delete';
                        }

                        if (rclonePathField) {
                            rclonePathField.value = 'rclone';
                        }
                    }, 200); // å¢åŠ å»¶è¿Ÿç¡®ä¿è‡ªå®šä¹‰åŒæ­¥é…ç½®ç•Œé¢å·²æ˜¾ç¤º
                }

                // æ»šåŠ¨åˆ°è¡¨å•é¡¶éƒ¨
                const taskSection = document.querySelector('.task-section');
                if (taskSection) {
                    taskSection.scrollIntoView({ behavior: 'smooth' });
                }
            }

            // ç™»å‡ºåŠŸèƒ½
            window.logout = function() {
                if (confirm('ç¡®å®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                    localStorage.removeItem('apiKey');
                    showMessage('å·²ç™»å‡ºï¼Œæ­£åœ¨è·³è½¬...', 'success');
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 1000);
                }
            }

            // éªŒè¯APIå¯†é’¥æœ‰æ•ˆæ€§
            function validateApiKey(apiKey) {
                return fetch('/tasks', {
                    headers: {
                        'X-API-Key': apiKey
                    }
                })
                .then(response => {
                    if (response.status === 401) {
                        return false;
                    }
                    return response.ok;
                })
                .catch(() => false);
            }

            // æš—é»‘æ¨¡å¼åˆ‡æ¢åŠŸèƒ½
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = themeToggle.querySelector('i');

            // æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„ä¸»é¢˜è®¾ç½®
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                themeIcon.className = 'fas fa-sun';
            }

            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                const isDark = document.body.classList.contains('dark-mode');

                if (isDark) {
                    themeIcon.className = 'fas fa-sun';
                    localStorage.setItem('theme', 'dark');
                } else {
                    themeIcon.className = 'fas fa-moon';
                    localStorage.setItem('theme', 'light');
                }
            });

            // å®šæœŸæ£€æŸ¥APIå¯†é’¥æœ‰æ•ˆæ€§
            setInterval(() => {
                validateApiKey(apiKey).then(isValid => {
                    const statusElement = document.getElementById('auth-status');
                    const statusDot = document.querySelector('.api-status');

                    if (isValid) {
                        statusElement.textContent = 'å·²è®¤è¯';
                        statusDot.style.backgroundColor = '#28a745';
                    } else {
                        statusElement.textContent = 'è®¤è¯å¤±æ•ˆ';
                        statusDot.style.backgroundColor = '#dc3545';
                        showMessage('è®¤è¯å·²å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•', 'error');
                        setTimeout(() => {
                            window.location.href = '/login';
                        }, 3000);
                    }
                });
            }, 60000); // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
        });
    </script>

    <!-- ç¼–è¾‘ä»»åŠ¡æ¨¡æ€æ¡† -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ç¼–è¾‘ä»»åŠ¡</h3>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editTaskForm">
                    <div class="form-group">
                        <label for="editTaskName">ä»»åŠ¡åç§°:</label>
                        <input type="text" id="editTaskName" name="name" required>
                    </div>

                    <div class="form-group">
                        <label for="editTaskSchedule">Cron è¡¨è¾¾å¼:</label>
                        <input type="text" id="editTaskSchedule" name="schedule" required placeholder="0 0 2 * * *">
                    </div>

                    <div class="form-group">
                        <label for="editTaskFunction">åŠŸèƒ½é€‰æ‹©:</label>
                        <select id="editTaskFunction" name="function" required>
                            <option value="">è¯·é€‰æ‹©åŠŸèƒ½</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="editTaskDescription">ä»»åŠ¡æè¿°:</label>
                        <input type="text" id="editTaskDescription" name="description" placeholder="å¯é€‰çš„ä»»åŠ¡æè¿°">
                    </div>

                    <!-- è‡ªå®šä¹‰åŒæ­¥ä»»åŠ¡é…ç½® -->
                    <div id="editCustomSyncConfig" class="custom-sync-config" style="display: none;">
                        <h4>è‡ªå®šä¹‰åŒæ­¥é…ç½®</h4>

                        <div class="form-group">
                            <label for="editSourcePath">æºè·¯å¾„:</label>
                            <input type="text" id="editSourcePath" name="source_path" placeholder="115:/ç”µå½±/">
                        </div>

                        <div class="form-group">
                            <label for="editTargetPath">ç›®æ ‡è·¯å¾„:</label>
                            <input type="text" id="editTargetPath" name="target_path" placeholder="/Users/user/data/media">
                        </div>

                        <!-- åŒæ­¥é€‰é¡¹å’ŒRcloneè·¯å¾„å­—æ®µéšè—ï¼Œä½¿ç”¨å†…ç½®é»˜è®¤å‚æ•° -->
                        <input type="hidden" id="editSyncOptions" name="sync_options" value="min-size=100M,strm-format,sync-delete">
                        <input type="hidden" id="editRclonePath" name="rclone_path" value="rclone">
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeEditModal()">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">ä¿å­˜ä¿®æ”¹</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
</html>
